<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Aline Vitalino Doces Gourmet</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #ffeeee;
      font-family: 'Montserrat', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px 10px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .app-container {
      background: #fff;
      width: 100%;
      max-width: 420px;
      border-radius: 24px;
      box-shadow: 0 12px 30px rgba(179, 0, 0, 0.2);
      padding: 25px 30px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .logo-container img {
      width: 140px;
      height: auto;
      border-radius: 20px;
      margin-bottom: 20px;
      user-select: none;
      -webkit-user-drag: none;
    }

    h1 {
      font-weight: 700;
      font-size: 28px;
      color: #b30000;
      margin-bottom: 30px;
      text-align: center;
      letter-spacing: 0.03em;
      user-select: none;
    }

    form {
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: #4a4a4a;
      margin-bottom: 6px;
      margin-left: 4px;
      user-select: none;
    }

    input, select {
      background-color: #fafafa;
      border: 1.8px solid #dcdcdc;
      border-radius: 14px;
      padding: 14px 18px;
      font-size: 16px;
      color: #222;
      margin-bottom: 20px;
      outline-offset: 2px;
      transition: border-color 0.3s ease;
    }
    input:focus, select:focus {
      border-color: #b30000;
      background-color: #fff5f5;
      outline: none;
      box-shadow: 0 0 8px rgba(179, 0, 0, 0.3);
    }

    input[readonly] {
      background-color: #f9f9f9;
      color: #888;
      cursor: not-allowed;
    }

    .inline-buttons {
      display: flex;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 30px;
    }

    button {
      flex: 1;
      padding: 16px 0;
      font-size: 18px;
      font-weight: 700;
      border-radius: 14px;
      border: none;
      cursor: pointer;
      color: white;
      transition: background-color 0.25s ease;
      box-shadow: 0 6px 10px rgba(0,0,0,0.07);
      user-select: none;
    }

    button:active {
      transform: scale(0.97);
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    .add-btn {
      background: linear-gradient(135deg, #ff7b7b, #d93e3e);
    }
    .add-btn:hover {
      background: linear-gradient(135deg, #d93e3e, #ff7b7b);
    }

    .clear-btn {
      background: #999999;
    }
    .clear-btn:hover {
      background: #7a7a7a;
    }

    .order-btn {
      background: linear-gradient(135deg, #28a745, #1e7e34);
      margin-top: 10px;
    }
    .order-btn:hover {
      background: linear-gradient(135deg, #1e7e34, #28a745);
    }

    hr {
      border: none;
      border-top: 1.5px solid #e2cfcf;
      margin: 30px 0;
      width: 100%;
      border-radius: 6px;
    }

    .pedido-lista {
      width: 100%;
      background: #fff0f0;
      border-radius: 14px;
      padding: 16px 20px;
      max-height: 160px;
      overflow-y: auto;
      font-size: 16px;
      color: #5a1a1a;
      box-shadow: inset 0 0 6px rgba(179,0,0,0.1);
      white-space: pre-wrap;
      user-select: text;
    }

    .pedido-total {
      font-weight: 700;
      font-size: 18px;
      color: #b30000;
      margin-top: 10px;
      user-select: none;
      text-align: right;
      width: 100%;
    }

    footer {
      margin-top: 35px;
      font-size: 14px;
      color: #a65d5d;
      user-select: none;
      text-align: center;
      width: 100%;
    }

    /* Scrollbar styling para lista pedidos */
    .pedido-lista::-webkit-scrollbar {
      width: 6px;
    }
    .pedido-lista::-webkit-scrollbar-thumb {
      background-color: #b30000cc;
      border-radius: 10px;
    }

    /* Pequenas melhorias para celular */
    @media (max-width: 400px) {
      .app-container {
        padding: 20px 15px 30px;
        border-radius: 20px;
      }
      h1 {
        font-size: 24px;
        margin-bottom: 24px;
      }
      button {
        font-size: 16px;
        padding: 14px 0;
      }
    }
  </style>
</head>
<body>
  <div class="app-container" role="main" aria-label="Aplicativo de pedidos Aline Vitalino Doces Gourmet">
    <div class="logo-container">
      <img src="https://i.imgur.com/1W2L9KK.jpeg" alt="Logo Aline Vitalino Doces Gourmet" draggable="false" />
    </div>

    <h1>Faça Sua Encomenda Aqui!</h1>

    <form id="pedidoForm" novalidate>
      <label for="nome">Nome:</label>
      <input type="text" id="nome" name="nome" required autocomplete="name" placeholder="Digite seu nome" />

      <label for="telefone">Telefone:</label>
      <input type="tel" id="telefone" name="telefone" required autocomplete="tel" placeholder="(99) 99999-9999" pattern="[\d\s\-\+\(\)]+" />

      <label for="data">Data:</label>
      <input type="date" id="data" name="data" readonly aria-readonly="true" />

      <label for="produtos">Produtos:</label>
      <select id="produtos" name="produtos" required aria-required="true">
        <option value="">Carregando...</option>
      </select>

      <label for="quantidade">Quantidade:</label>
      <input type="number" id="quantidade" name="quantidade" min="1" value="1" required />

      <div class="inline-buttons">
        <button type="button" class="add-btn" aria-label="Adicionar ao carrinho" onclick="adicionarCarrinho()">Adicionar ao Carrinho</button>
        <button type="button" class="clear-btn" aria-label="Apagar formulário e carrinho" onclick="limparFormulario()">Apagar</button>
      </div>

      <hr />

      <div class="pedido-lista" id="listaPedidos" aria-live="polite" aria-relevant="additions" role="region" tabindex="0">
        Nenhum item no carrinho.
      </div>

      <div class="pedido-total" id="totalPedido" aria-atomic="true">Total: R$ 0,00</div>

      <hr />

      <label for="valor">Valor Total (R$):</label>
      <input type="number" id="valor" name="valor" readonly aria-readonly="true" />

      <label for="vendedor">Vendedor:</label>
      <input type="text" id="vendedor" name="vendedor" value="Isa" readonly aria-readonly="true" />

      <button type="submit" class="order-btn" aria-label="Fazer pedido">Fazer Pedido</button>
    </form>

    <footer>
      Aline Vitalino Doces Gourmet - 2025
    </footer>
  </div>

  <script>
    const produtosFirebase = {};
    const carrinho = [];

    const TELEGRAM_BOT_TOKEN = '7606421931:AAEKx9TdlH8xQAElgplPjEKq1K7Px33d4DA';
    const TELEGRAM_CHAT_ID = '7863276089';

    window.onload = () => {
      const hoje = new Date().toISOString().split("T")[0];
      document.getElementById("data").value = hoje;
      carregarProdutos();
    };

    function carregarProdutos() {
      fetch("https://testepedidosstatus-default-rtdb.europe-west1.firebasedatabase.app/.json")
        .then(res => res.json())
        .then(data => {
          const select = document.getElementById("produtos");
          select.innerHTML = '<option value="">Selecione um produto</option>';
          for (const produto in data) {
            produtosFirebase[produto] = parseFloat(data[produto]);
            const option = document.createElement("option");
            option.value = produto;
            option.textContent = `${produto} (R$ ${data[produto]})`;
            select.appendChild(option);
          }
        })
        .catch(() => {
          document.getElementById("produtos").innerHTML = '<option value="">Erro ao carregar produtos</option>';
        });
    }

    function adicionarCarrinho() {
      const produto = document.getElementById("produtos").value;
      const quantidade = parseInt(document.getElementById("quantidade").value);

      if (!produto) {
        alert("Selecione um produto válido.");
        return;
      }
      if (!quantidade || quantidade < 1) {
        alert("Informe uma quantidade válida.");
        return;
      }

      const preco = produtosFirebase[produto];
      const subtotal = preco * quantidade;

      carrinho.push({ produto, quantidade, subtotal });
      atualizarListaCarrinho();
    }

    function atualizarListaCarrinho() {
      const lista = document.getElementById("listaPedidos");
      const totalDiv = document.getElementById("totalPedido");
      const valorCampo = document.getElementById("valor");

      if (carrinho.length === 0) {
        lista.textContent = "Nenhum item no carrinho.";
        totalDiv.textContent = "Total: R$ 0,00";
        valorCampo.value = "";
        return;
      }

      lista.innerHTML = "";
      let total = 0;
      carrinho.forEach(item => {
        const linha = document.createElement("div");
        linha.textContent = `${item.quantidade}x ${item.produto} R$ ${item.subtotal.toFixed(2)}`;
        lista.appendChild(linha);
        total += item.subtotal;
      });

      totalDiv.textContent = `Total: R$ ${total.toFixed(2)}`;
      valorCampo.value = total.toFixed(2);
    }

    function limparFormulario() {
      document.getElementById("pedidoForm").reset();
      document.getElementById("data").value = new Date().toISOString().split("T")[0];
      document.getElementById("vendedor").value = "Isa";
      carrinho.length = 0;
      atualizarListaCarrinho();
    }

    async function enviarPedidoTelegram(mensagem) {
      const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
      const payload = {
        chat_id: TELEGRAM_CHAT_ID,
        text: mensagem,
        parse_mode: "Markdown"
      };

      try {
        const response = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await response.json();
        return data.ok;
      } catch {
        return false;
      }
    }

    document.getElementById("pedidoForm").addEventListener("submit", async e => {
      e.preventDefault();

      if (carrinho.length === 0) {
        alert("Adicione pelo menos um item ao carrinho antes de enviar o pedido.");
        return;
      }

      const nome = document.getElementById("nome").value.trim();
      const telefone = document.getElementById("telefone").value.trim();

      if (!nome) {
        alert("Por favor, preencha o nome do cliente.");
        return;
      }
      if (!telefone) {
        alert("Por favor, preencha o telefone do cliente.");
        return;
      }

      const valorTotal = document.getElementById("valor").value;

      let produtosTxt = "";
      carrinho.forEach(item => {
        produtosTxt += `${item.quantidade}x ${item.produto} R$ ${item.subtotal.toFixed(2)}\n`;
      });

      const mensagem =
        `*Novo Pedido Azul*\n` +
        `-----------------------------------\n` +
        `👤Cliente: ${nome}\n` +
        `📞Fone: ${telefone}\n` +
        `💵Valor: R$ ${valorTotal}\n` +
        `📦Produtos:\n${produtosTxt}` +
        `-----------------------------------`;

      const sucesso = await enviarPedidoTelegram(mensagem);

      if (sucesso) {
        alert("Pedido enviado com sucesso ao Telegram!");
        limparFormulario();
      } else {
        alert("Erro ao enviar o pedido. Tente novamente.");
      }
    });
  </script>
</body>
</html>
